<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/batch"
	xmlns:beans="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
                    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
					http://www.springframework.org/schema/batch
	                http://www.springframework.org/schema/batch/spring-batch-2.1.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd">


	<beans:import resource="applicationContext.xml" />

	<step id="abstractParentStep" abstract="true">
		<tasklet>
			<chunk commit-interval="1000">
			</chunk>
		</tasklet>
	</step>

	<beans:bean id="jobListener" class="com.mycompany.listener.JobListener" />

	<job id="insertJob">
		<step id="step1" parent="abstractParentStep">
			<tasklet>
				<chunk reader="personnePhysiqueReader" writer="personnePhysiquejdbcBatchWriter" />
			</tasklet>
			<end on="*" />
		</step>
		<listeners>
			<listener ref="jobListener" />
		</listeners>
	</job>

	<job id="elasticJob">
		<step id="elasticStep" parent="abstractParentStep">
			<tasklet>
				<chunk reader="personnePhysiqueReader" writer="personnePhysiqueElasticIndexer" />
			</tasklet>
			<end on="*" />
		</step>
		<listeners>
			<listener ref="jobListener" />
		</listeners>
	</job>


	<beans:bean id="personnePhysiquejdbcBatchWriter"
		class="org.springframework.batch.item.database.JdbcBatchItemWriter">
		<beans:property name="dataSource" ref="dataSource" />
		<beans:property name="sql"
			value="insert into personnephysique (prenom, nom, codePostal, pays, dateNaissance) values (?, ?, ?, ?, ?)" />
		<beans:property name="itemPreparedStatementSetter" ref="personnePhysiqueStatementSetter" />
	</beans:bean>

<!--
To run the job from the command line type the following:
mvn exec:java -Dexec.mainClass=org.springframework.batch.core.launch.support.CommandLineJobRunner -Dexec.args="jobs.xml insertJob"
 -->


</beans:beans>